from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, InputFile
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
from web import keep_alive

# توکن ربات
TOKEN = "7723810377:AAGAQ6JRI4Z5ZHRGmXsasPJqEakhGreHqwA"

# آیدی تلگرام ادمین بدون @
ADMIN_USERNAME = "emihesi"

# زبان کاربران
user_language = {}

# اطلاعات کتاب‌ها
books = {
    "book1": {
        "title": "راهنمای جامع درمان در گفتاردرمانی",
        "description": """راهنمای جامع ارزیابی و درمان تمام اختلالات گفتاردرمانی
یک مرجع کامل، کاربردی و دسته‌بندی‌شده برای ارزیابی و درمان تمام اختلالات گفتار و زبان، شامل نکات کلینیکی، جدول‌های کاربردی، مراحل درمانی، و رویکردهای روز دنیا.
مناسب برای گفتاردرمانگرانی که می‌خوان سریع، دقیق و علمی تصمیم‌گیری کنند.
قیمت با تخفیف ویژه: ۱۰۸,۰۰۰ تومان""",
        "demo_file": "دمو_راهنمای_جامع_درمان_در_گفتاردرمانی.pdf"
    },
    "book2": {
        "title": "راهنمای جامع اختلالات صوت",
        "description": """این کتاب کامل‌ترین راهنمای گفتاردرمانگران برای تاریخچه‌گیری، ارزیابی و درمان اختلالات صوت است.
در این کتاب، فرم‌ها و چک‌لیست‌های کاربردی برای ارزیابی دقیق اختلالات صوت قرار داده شده و تمرینات درمانی ساده و مرحله‌به‌مرحله همراه با نکات مهم بالینی ارائه شده است.
مناسب گفتاردرمانگرانی که می‌خواهند در زمینه درمان اختلالات صوت تخصص و تسلط بیشتری پیدا کنند.

قیمت با تخفیف: ۱۴۴,۰۰۰ تومان""",
        "demo_file": "دمو_اختلالات_صوت.pdf"
    },
    "book3": {
        "title": "راهنمای جامع عقب ماندگی ذهنی",
        "description": """این کتاب یه راهنمای کامل و ساده است برای همه کسانی که می‌خوان عقب‌ماندگی ذهنی رو بهتر بشناسن، درست ارزیابی کنن و برنامه درمانی مناسب طراحی کنن. با زبان راحت و قابل فهم، مراحل تاریخچه‌گیری، ارزیابی و درمان رو مرحله به مرحله توضیح داده تا هم والدین و هم متخصصان گفتاردرمانی بتونن راحت‌تر کمک کنن.
این کتاب بهترین همراه برای بهبود کیفیت زندگی کودکان با نیازهای ویژه است.

قیمت با تخفیف: ۱۳۵,۰۰۰ تومان""",
        "demo_file": "دمو_راهنمای_جامع_عقب_ماندگی_ذهنی.pdf"
    },
    "book4": {
        "title": "راهنمای جامع آسیب شنوایی",
        "description": """📘 راهنمای جامع آسیب شنوایی

این کتاب یک راهنمای کاربردی و کامل برای گفتاردرمانگران و دانشجویان است تا به‌صورت دقیق با ارزیابی و درمان آسیب‌های شنوایی آشنا شوند. از شناخت ساختار گوش و انواع آسیب‌های شنوایی گرفته تا تکنیک‌های درمانی، تجهیزات کمک‌شنوایی، و همکاری مؤثر با خانواده و مدرسه – همه‌ی آنچه نیاز دارید، در این کتاب آمده است.

✅ ساده، تخصصی و مناسب استفاده بالینی  
✅ فرم‌ها، چک‌لیست‌ها و ابزارهای آماده  
✅ تالیف‌شده بر اساس منابع علمی معتبر و تجربه‌ی بالینی

💰 قیمت با تخفیف ویژه: فقط ۱۲۳,۰۰۰ تومان""",
        "demo_file": "دمو_راهنمای_جامع_آسیب_شنوایی.pdf"
    },
    "book5": {
        "title": "راهنمای جامع اتیسم",
        "description": """📘 راهنمای جامع تاریخچه‌گیری و ارزیابی و درمان اتیسم

این کتاب یه راهنمای کامل و کاربردیه برای گفتاردرمانگرهایی که با کودکان اتیسم کار می‌کنن. همه‌چیز از تعریف و ویژگی‌های اتیسم گرفته تا روش‌های دقیق ارزیابی، نحوه گرفتن تاریخچه درست، ابزارهای استاندارد، طراحی برنامه درمانی، تکنیک‌های تقویت مهارت‌های ارتباطی، و حتی آموزش خانواده و مدرسه رو پوشش می‌ده. با مطالعه این کتاب، دیگه برای شروع و ادامه درمان کودک اتیسم، چیزی کم نداری.

این کتاب خیلی ساده و روان نوشته شده تا هم برای گفتاردرمانگرهای تازه‌کار مفید باشه، هم برای اونایی که دنبال یک منبع جمع‌وجور و کاربردی هستن.

💰 قیمت با تخفیف: فقط ۱۱۴,۰۰۰ تومان""",
        "demo_file": "دمو_راهنمای_جامع_اتیسم.pdf"
    },
    "book6": {
        "title": "راهنمای جامع آسپرگر",
        "description": """📘 راهنمای جامع تاریخچه گیری و ارزیابی و درمان آسپرگر

این کتاب یک مرجع کامل و تخصصی است که به گفتاردرمانگران و خانواده‌ها کمک می‌کند تا با اختلال آسپرگر بهتر آشنا شوند و بهترین روش‌های ارزیابی و درمان را به کار ببرند. از تعریف و علل گرفته تا تکنیک‌های درمانی و همکاری با خانواده و مدرسه، همه چیز به زبان ساده و کاربردی توضیح داده شده است.

قیمت با تخفیف ویژه: ۹۹,۰۰۰ تومان""",
        "demo_file": "دمو_راهنمای_جامع_آسپرگر.pdf"
    },
    "book7": {
        "title": "راهنمای جامع اختلالات زبانی",
        "description": """این کتاب راهنمای جامع و کامل درباره اختلالات زبانی است که به شما کمک می‌کند تا بهتر بفهمید زبان چیست و وقتی زبان دچار مشکل می‌شود، چطور آن را تشخیص دهید و درمان کنید. در این کتاب درباره انواع اختلالات زبانی، علت‌ها و عوامل مختلف آن، روش‌های درست گرفتن تاریخچه از کودک و خانواده، ابزارهای دقیق ارزیابی زبان و نحوه تشخیص درست صحبت شده است. همچنین یاد می‌گیرید چطور برنامه درمانی شخصی‌سازی شده طراحی کنید و با خانواده و مدرسه همکاری داشته باشید تا کودک بهترین پیشرفت را داشته باشد. در نهایت نکات مهم و چالش‌های درمان نیز بررسی شده‌اند تا گفتاردرمانگران بتوانند با اعتماد و دانش کافی به درمان بپردازند.

این کتاب مناسب گفتاردرمانگران، دانشجویان، خانواده‌ها و هر کسی است که می‌خواهد درباره اختلالات زبانی و راه‌های کمک به کودکان با این مشکلات بیشتر بداند.
قیمت: ۹۹,۰۰۰ تومان (با تخفیف)""",
        "demo_file": "دمو_راهنمای_جامع_اختلالات_زبانی.pdf"
    },
    "book8": {
        "title": "راهنمای جامع زبان پریشی",
        "description": """این کتاب یک راهنمای کامل و کاربردی برای شناخت، ارزیابی و درمان زبان‌پریشی است. زبان‌پریشی یعنی مشکلات جدی در درک و بیان زبان که می‌تواند بر ارتباط و زندگی روزمره تأثیر بگذارد. در این کتاب، به زبانی ساده و واضح یاد می‌گیرید چطور با استفاده از روش‌های علمی و تخصصی، علت‌ها و عوامل زبان‌پریشی را بشناسید، تاریخچه دقیق بگیرید، ارزیابی کنید و برنامه درمانی مناسب طراحی و اجرا کنید. همچنین نکات مهم همکاری با خانواده و مدرسه، پیگیری پیشرفت و رفع چالش‌های درمان هم به خوبی توضیح داده شده‌اند. این کتاب مخصوص گفتاردرمانگران و متخصصان حوزه زبان و گفتار است که می‌خواهند به بهترین شکل به بیماران خود کمک کنند.

**قیمت با تخفیف: ۱۰۸۰۰۰ تومان**
""",
        "demo_file": "دمو_راهنمای_جامع_زبان_پریشی.pdf"
    },
    "book9": {
        "title": "راهنمای جامع ناروانی",
        "description": """🔹 **راهنمای جامع تاریخچه‌گیری و ارزیابی و درمان ناروانی**
کتابی کامل و کاربردی برای گفتاردرمانگران، دانشجویان و والدین علاقه‌مند است که هر آنچه برای شناخت، ارزیابی و درمان مؤثر ناروانی (مثل لکنت زبان) نیاز دارید را در اختیارتان قرار می‌دهد. در این کتاب از اصول اولیه گرفته تا پیشرفته‌ترین روش‌های درمانی، همراه با فرم‌ها، تمرینات، تکنیک‌ها و توصیه‌های حرفه‌ای ارائه شده تا بتوانید با اطمینان، برنامه‌درمانی مؤثر و فردمحور طراحی و اجرا کنید.

💡 مناسب برای درمانگران گفتار، دانشجویان گفتاردرمانی، والدین کودکان دارای ناروانی، و هر فردی که با موضوع لکنت و ناروانی سروکار دارد.

💰 **قیمت با تخفیف ویژه: ۱۰۲,۰۰۰ تومان**
""",
        "demo_file": "دمو_راهنمای_جامع_ناروانی.pdf"
    },
    "book10": {
        "title": "راهنمای جامع اختلالات صداهای گفتار",
        "description": """این کتاب جامع، راهنمای کامل و کاربردی برای تاریخچه‌گیری، ارزیابی و درمان اختلالات صداهای گفتار در کودکان است که با زبان ساده و مثال‌های عملی، مناسب گفتاردرمانگران، دانشجویان و خانواده‌ها طراحی شده است تا بهترین روش‌ها را برای بهبود گفتار کودک به کار ببرند. قیمت با تخفیف ویژه: ۱۱۱,۰۰۰ تومان.
        """,
        "demo_file": "دمو_راهنمای_جامع_اختلالات_صداهای_گفتار.pdf"
    },
    "book11": {
        "title": "راهنمای جامع دیزآرتری",
        "description": """این کتاب یک راهنمای جامع و کاربردی برای درمانگران گفتار، دانشجویان و خانواده‌هاست که به‌صورت گام‌به‌گام به تاریخچه‌گیری، ارزیابی، تشخیص و درمان اختلال دیزآرتری می‌پردازد. با پوشش کامل مفاهیم پایه، تکنیک‌های درمانی، تمرینات عملی، فرم‌های بالینی و منابع معتبر، این اثر یک مرجع حرفه‌ای و قابل اعتماد در زمینه دیزآرتری محسوب می‌شود.
**قیمت با تخفیف ویژه: ۶۳,۰۰۰ تومان** ✅
        """,
        "demo_file": "دمو_راهنمای_جامع_دیزآرتری.pdf"
    },
    "book12": {
        "title": "راهنمای جامع آپراکسی",
        "description": """کتاب «راهنمای جامع تاریخچه‌گیری، ارزیابی و درمان آپراکسی گفتار» یک راهنمای کامل و کاربردی است که تمام مراحل شناسایی، بررسی و درمان آپراکسی گفتار را با زبانی ساده و علمی پوشش می‌دهد. این کتاب با ارائه فرم‌ها و چک‌لیست‌های تخصصی، روش‌های ارزیابی دقیق و برنامه‌های درمانی گام‌به‌گام، به درمانگران کمک می‌کند بهترین نتیجه را در بهبود گفتار بیماران خود بگیرند.

قیمت با تخفیف ویژه: ۸۴,۰۰۰ تومان
        """,
        "demo_file": "دمو_راهنمای_جامع_آپراکسی.pdf"
    },
     "book13": {
        "title": "راهنمای جامع اختلال بلع",
        "description": """کتاب «راهنمای جامع تاریخچه‌گیری و ارزیابی و درمان اختلال بلع» یک مرجع کامل و کاربردی است که تمامی مراحل از شناخت اولیه، ارزیابی دقیق، طراحی برنامه درمانی تا پایش پیشرفت و پایان درمان را به زبانی ساده و علمی آموزش می‌دهد. این کتاب برای درمانگران گفتاردرمانی، دانشجویان و خانواده‌ها طراحی شده تا به بهبود کیفیت زندگی بیماران کمک کند.
قیمت با تخفیف ویژه: ۶۰,۰۰۰ تومان
        """,
        "demo_file": "دمو_راهنمای_جامع_اختلال_بلع.pdf"
    }
}

# شروع با انتخاب زبان
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        [InlineKeyboardButton("فارسی", callback_data="lang_fa"),
         InlineKeyboardButton("English", callback_data="lang_en")]
    ]
    await update.message.reply_text("لطفاً زبان مورد نظر را انتخاب کنید:", reply_markup=InlineKeyboardMarkup(keyboard))

# مدیریت انتخاب زبان
async def handle_language(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    user_id = query.from_user.id

    if query.data == "lang_fa":
        user_language[user_id] = "fa"
        await query.answer()
        await query.message.reply_text("زبان فارسی انتخاب شد. لطفاً یکی از کتاب‌های زیر را انتخاب کن:")

        keyboard = [[InlineKeyboardButton(book["title"], callback_data=key)] for key, book in books.items()]
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.message.reply_text("کتاب‌ها:", reply_markup=reply_markup)

    elif query.data == "lang_en":
        user_language[user_id] = "en"
        await query.answer()
        await query.message.reply_text("English content coming soon...")

# نمایش توضیحات و دمو کتاب
async def book_detail(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    key = query.data

    if key in books:
        book = books[key]
        await query.message.reply_text(book["description"])

        try:
            with open(book["demo_file"], "rb") as demo:
                await query.message.reply_document(InputFile(demo))
        except FileNotFoundError:
            await query.message.reply_text("فایل دمو پیدا نشد. لطفاً بررسی شود.")

        buy_keyboard = [[InlineKeyboardButton("خرید کتاب", callback_data=f"buy_{key}")]]
        await query.message.reply_text("برای خرید، روی دکمه‌ی زیر کلیک کن:", reply_markup=InlineKeyboardMarkup(buy_keyboard))

# سیستم خرید کتاب
async def buy_book(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    await query.message.reply_text("محبت کنید مبلغ مورد نظر را به شماره کارت زیر واریز کنید:\n6037991922825686\nبه نام امیرحسین عزیزی فروتقه")

    buy_link = f"https://t.me/{ADMIN_USERNAME}"
    keyboard = [[InlineKeyboardButton("ارسال رسید خرید", url=buy_link)]]
    await query.message.reply_text("برای اشتراک رسید خرید، روی دکمه زیر کلیک کن:", reply_markup=InlineKeyboardMarkup(keyboard))

# اجرای ربات
def main():
    keep_alive()
    app = Application.builder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(handle_language, pattern="^lang_"))
    app.add_handler(CallbackQueryHandler(buy_book, pattern="^buy_"))
    app.add_handler(CallbackQueryHandler(book_detail))
    print("ربات اجرا شد...")
    app.run_polling()

if __name__ == "__main__":
    main()
